!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";function csjsInserter(){var args=Array.prototype.slice.call(arguments),result=csjs.apply(null,args);return global.document&&insertCss(csjs.getCss(result)),result}var csjs=require("csjs"),insertCss=require("insert-css");module.exports=csjsInserter}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{csjs:6,"insert-css":20}],2:[function(require,module,exports){"use strict";module.exports=require("csjs/get-css")},{"csjs/get-css":5}],3:[function(require,module,exports){"use strict";var csjs=require("./csjs");module.exports=csjs,module.exports.csjs=csjs,module.exports.getCss=require("./get-css")},{"./csjs":1,"./get-css":2}],4:[function(require,module,exports){"use strict";module.exports=require("./lib/csjs")},{"./lib/csjs":10}],5:[function(require,module,exports){"use strict";module.exports=require("./lib/get-css")},{"./lib/get-css":14}],6:[function(require,module,exports){"use strict";var csjs=require("./csjs");module.exports=csjs(),module.exports.csjs=csjs,module.exports.noScope=csjs({noscope:!0}),module.exports.getCss=require("./get-css")},{"./csjs":4,"./get-css":5}],7:[function(require,module,exports){"use strict";module.exports=function(integer){if(0===integer)return"0";for(var str="";integer>0;)str="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[integer%62]+str,integer=Math.floor(integer/62);return str}},{}],8:[function(require,module,exports){"use strict";function getClassChain(obj){function traverse(obj){return Object.keys(obj).forEach(function(key){visited[key]||(visited[key]=!0,acc.push(key),traverse(obj[key]))})}var visited={},acc=[];return traverse(obj),acc}var makeComposition=require("./composition").makeComposition;module.exports=function(classes,keyframes,compositions){var keyframesObj=Object.keys(keyframes).reduce(function(acc,key){var val=keyframes[key];return acc[val]=makeComposition([key],[val],!0),acc},{});return Object.keys(classes).reduce(function(acc,key){var val=classes[key],composition=compositions[key],extended=composition?getClassChain(composition):[],allClasses=[key].concat(extended),unscoped=allClasses.map(function(name){return classes[name]?classes[name]:name});return acc[val]=makeComposition(allClasses,unscoped),acc},keyframesObj)}},{"./composition":9}],9:[function(require,module,exports){"use strict";function makeComposition(classNames,unscoped,isAnimation){var classString=classNames.join(" ");return Object.create(Composition.prototype,{classNames:{value:Object.freeze(classNames),configurable:!1,writable:!1,enumerable:!0},unscoped:{value:Object.freeze(unscoped),configurable:!1,writable:!1,enumerable:!0},className:{value:classString,configurable:!1,writable:!1,enumerable:!0},selector:{value:classNames.map(function(name){return isAnimation?name:"."+name}).join(", "),configurable:!1,writable:!1,enumerable:!0},toString:{value:function(){return classString},configurable:!1,writeable:!1,enumerable:!1}})}function isComposition(value){return value instanceof Composition}function ignoreComposition(values){return values.reduce(function(acc,val){return isComposition(val)&&val.classNames.forEach(function(name,i){acc[name]=val.unscoped[i]}),acc},{})}function Composition(){}module.exports={makeComposition:makeComposition,isComposition:isComposition,ignoreComposition:ignoreComposition}},{}],10:[function(require,module,exports){"use strict";function selectorize(value){return isComposition(value)?value.selector:value}function joiner(strings,values){return strings.map(function(str,i){return i!==values.length?str+values[i]:str}).join("")}function without(obj,unwanted){return Object.keys(obj).reduce(function(acc,key){return unwanted[key]||(acc[key]=obj[key]),acc},{})}var extractExtends=require("./css-extract-extends"),composition=require("./composition"),isComposition=composition.isComposition,ignoreComposition=composition.ignoreComposition,buildExports=require("./build-exports"),scopify=require("./scopeify"),cssKey=require("./css-key"),extractExports=require("./extract-exports");module.exports=function(opts){opts=void 0===opts?{}:opts;var noscope=void 0!==opts.noscope&&opts.noscope;return function(strings,values){for(var values=Array(arguments.length-1),i=1;i<arguments.length;i++)values[i-1]=arguments[i];var css=joiner(strings,values.map(selectorize)),ignores=ignoreComposition(values),scope=noscope?extractExports(css):scopify(css,ignores),extracted=extractExtends(scope.css),localClasses=without(scope.classes,ignores),localKeyframes=without(scope.keyframes,ignores),compositions=extracted.compositions,exports=buildExports(localClasses,localKeyframes,compositions);return Object.defineProperty(exports,cssKey,{enumerable:!1,configurable:!1,writeable:!1,value:extracted.css})}}},{"./build-exports":8,"./composition":9,"./css-extract-extends":11,"./css-key":12,"./extract-exports":13,"./scopeify":19}],11:[function(require,module,exports){"use strict";function splitter(match){return match.split(",").map(getClassName)}function getClassName(str){var trimmed=str.trim();return"."===trimmed[0]?trimmed.substr(1):trimmed}var regex=(require("./composition").makeComposition,/\.([^\s]+)(\s+)(extends\s+)(\.[^{]+)/g);module.exports=function(css){function extractCompositions(acc,match){var extendee=getClassName(match[1]),keyword=match[3],extended=match[4],index=match.index+match[1].length+match[2].length,len=keyword.length+extended.length;return acc.css=acc.css.slice(0,index)+" "+acc.css.slice(index+len+1),splitter(extended).forEach(function(className){acc.compositions[extendee]||(acc.compositions[extendee]={}),acc.compositions[className]||(acc.compositions[className]={}),acc.compositions[extendee][className]=acc.compositions[className]}),acc}for(var found,matches=[];found=regex.exec(css);)matches.unshift(found);return matches.reduce(extractCompositions,{css:css,compositions:{}})}},{"./composition":9}],12:[function(require,module,exports){"use strict";module.exports=" css "},{}],13:[function(require,module,exports){"use strict";function extractExports(css){return{css:css,keyframes:getExport(css,keyframesRegex),classes:getExport(css,classRegex)}}function getExport(css,regex){for(var match,prop={};null!==(match=regex.exec(css));){var name=match[2];prop[name]=name}return prop}var regex=require("./regex"),classRegex=regex.classRegex,keyframesRegex=regex.keyframesRegex;module.exports=extractExports},{"./regex":16}],14:[function(require,module,exports){"use strict";var cssKey=require("./css-key");module.exports=function(csjs){return csjs[cssKey]}},{"./css-key":12}],15:[function(require,module,exports){"use strict";module.exports=function(str){for(var hash=5381,i=str.length;i;)hash=33*hash^str.charCodeAt(--i);return hash>>>0}},{}],16:[function(require,module,exports){"use strict";var findClasses=/(\.)(?!\d)([^\s\.,{\[>+~#:)]*)(?![^{]*})/.source,findKeyframes=/(@\S*keyframes\s*)([^{\s]*)/.source,ignoreComments=/(?!(?:[^*\/]|\*[^\/]|\/[^*])*\*+\/)/.source,classRegex=new RegExp(findClasses+ignoreComments,"g"),keyframesRegex=new RegExp(findKeyframes+ignoreComments,"g");module.exports={classRegex:classRegex,keyframesRegex:keyframesRegex,ignoreComments:ignoreComments}},{}],17:[function(require,module,exports){function replaceAnimations(result){var animations=Object.keys(result.keyframes).reduce(function(acc,key){return acc[result.keyframes[key]]=key,acc},{}),unscoped=Object.keys(animations);if(unscoped.length){var regexStr="((?:animation|animation-name)\\s*:[^};]*)("+unscoped.join("|")+")([;\\s])"+ignoreComments,regex=new RegExp(regexStr,"g");return{css:result.css.replace(regex,function(match,preamble,name,ending){return preamble+animations[name]+ending}),keyframes:result.keyframes,classes:result.classes}}return result}var ignoreComments=require("./regex").ignoreComments;module.exports=replaceAnimations},{"./regex":16}],18:[function(require,module,exports){"use strict";var encode=require("./base62-encode"),hash=require("./hash-string");module.exports=function(fileSrc){var suffix=encode(hash(fileSrc));return function(name){return name+"_"+suffix}}},{"./base62-encode":7,"./hash-string":15}],19:[function(require,module,exports){"use strict";function scopify(css,ignores){function scopeCss(result,key){function replaceFn(fullMatch,prefix,name){var scopedName=ignores[name]?name:makeScopedName(name);return result[key][scopedName]=name,prefix+scopedName}var replacer=replacers[key];return{css:result.css.replace(replacer,replaceFn),keyframes:result.keyframes,classes:result.classes}}var makeScopedName=fileScoper(css),replacers={classes:classRegex,keyframes:keyframesRegex},result=Object.keys(replacers).reduce(scopeCss,{css:css,keyframes:{},classes:{}});return replaceAnimations(result)}var fileScoper=require("./scoped-name"),replaceAnimations=require("./replace-animations"),regex=require("./regex"),classRegex=regex.classRegex,keyframesRegex=regex.keyframesRegex;module.exports=scopify},{"./regex":16,"./replace-animations":17,"./scoped-name":18}],20:[function(require,module,exports){var inserted={};module.exports=function(css,options){if(!inserted[css]){inserted[css]=!0;var elem=document.createElement("style");elem.setAttribute("type","text/css"),"textContent"in elem?elem.textContent=css:elem.styleSheet.cssText=css;var head=document.getElementsByTagName("head")[0];options&&options.prepend?head.insertBefore(elem,head.childNodes[0]):head.appendChild(elem)}}},{}],21:[function(require,module,exports){module.exports=function yoyoifyAppendChild(el,childs){for(var i=0;i<childs.length;i++){var node=childs[i];if(Array.isArray(node))yoyoifyAppendChild(el,node);else{if(("number"==typeof node||"boolean"==typeof node||node instanceof Date||node instanceof RegExp)&&(node=node.toString()),"string"==typeof node){if(el.lastChild&&"#text"===el.lastChild.nodeName){el.lastChild.nodeValue+=node;continue}node=document.createTextNode(node)}node&&node.nodeType&&el.appendChild(node)}}}},{}],22:[function(require,module,exports){function playVideo(e){streaming||(video.setAttribute("width",width),video.setAttribute("height",height),canvas.setAttribute("width",width),canvas.setAttribute("height",height),streaming=!0)}function takePicture(e){e.preventDefault(),snapshot(localMediaStream)}function snapshot(e){var t=processing.getContext("2d");if(width&&height){processing.width=width,processing.height=height,t.drawImage(video,0,0,width,height);var n=filter.crazyAlternative(t);t.putImageData(n,0,0);var a=processing.toDataURL("image/webp",.95);a&&"data:,"!==a?photo.setAttribute("src",a):console.error("Image not available")}else clearphoto()}function clearphoto(){var e=canvas.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,canvas.width,canvas.height);var t=canvas.toDataURL("image/png");photo.setAttribute("src",t)}function savePicture(e){var t=generateImageName();t+=".txt";var n=photo.getAttribute("src");console.log("DOWNLOAD",t,n)}function generateImageName(){return"imageName"+Math.floor(Math.random())}function start(){stopVideo(),clearphoto();var e=videoSelect.value,t={video:{deviceId:e?{exact:e}:void 0}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(gotStream).catch(handleError):video.src="fallback.webm"}function stopVideo(){localMediaStream&&(localMediaStream.getTracks().forEach(function(e){e.stop()}),localMediaStream=null)}function gotStream(e){localMediaStream=e,video.srcObject=e,video.onloadedmetadata=function(e){width=video.videoWidth,height=video.videoHeight/(video.videoWidth/width),video.play()},video.onplay=function(){var e=canvas.getContext("2d");draw(video,e,400,300)}}function draw(e,t){t.drawImage(e,0,0,width,height);var n=t.getImageData(0,0,width,height);n.data=filter.greyscale(null,n.data),t.putImageData(n,0,0),setTimeout(function(){draw(e,t)},16)}function handleError(e){e&&console.error(e.name+": "+e.message),console.error("navigator.getUserMedia error: ",e)}var _select,_,_select2,_video,_canvas,_img,_canvas2,_code,_code2,_h,_h2,_2,_camera,_h3,_button,_canvas3,_h4,_button2,_div,_3,_appendChild=require("yo-yoify/lib/appendChild"),_templateObject=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n  html { box-sizing: border-box; }\n  *, *:before, *:after { box-sizing: inherit; }\n  body { margin: 0; }\n  .mediabox {\n    display: flex;\n    flex-direction: column;\n    width: 100vw;\n    height: 100vh;\n    padding: 50px;\n    align-items: center;\n  }\n  .selector {\n    display: block;\n  }\n  .processing {\n    position: absolute;\n    visibility: hidden;\n  }\n  .button {\n    width: 100px;\n  }\n"],["\n  html { box-sizing: border-box; }\n  *, *:before, *:after { box-sizing: inherit; }\n  body { margin: 0; }\n  .mediabox {\n    display: flex;\n    flex-direction: column;\n    width: 100vw;\n    height: 100vh;\n    padding: 50px;\n    align-items: center;\n  }\n  .selector {\n    display: block;\n  }\n  .processing {\n    position: absolute;\n    visibility: hidden;\n  }\n  .button {\n    width: 100px;\n  }\n"]),csjs=require("csjs-inject"),css=csjs(_templateObject),width=240,height=0,streaming=!1,localMediaStream=null,action={play:playVideo,snap:takePicture,save:savePicture,start:start},videoSelect=(_select=document.createElement("select"),_select.setAttribute("class",""+String(css.selector)),_select),audioInputSelect=(_=document.createElement("select"),_.setAttribute("class",""+String(css.selector)),_),audioOutputSelect=(_select2=document.createElement("select"),_select2.setAttribute("class",""+String(css.selector)),_select2),video=(_video=document.createElement("video"),_video.oncanplay=action.play,_video.setAttribute("controls","controls"),_video.setAttribute("class","video"),_video.textContent="Video stream not available.",_video),canvas=_canvas=document.createElement("canvas"),photo=(_img=document.createElement("img"),_img.setAttribute("alt","The screen capture will appear in this box."),_img),processing=(_canvas2=document.createElement("canvas"),_canvas2.setAttribute("class",""+String(css.processing)),_canvas2),element=(_3=document.createElement("div"),_3.setAttribute("class",""+String(css.mediabox)),_appendChild(_3,["\n    ",(_h=document.createElement("h1"),_appendChild(_h,[" works only on ",(_code=document.createElement("code"),_code.textContent="https",_code)," or ",(_code2=document.createElement("code"),_code2.textContent=" localhost ",_code2)," "]),_h),"\n    ",videoSelect,"\n    ",audioInputSelect,"\n    ",audioOutputSelect,"\n    ",(_camera=document.createElement("div"),_camera.setAttribute("class","camera"),_appendChild(_camera,["\n      ",(_h2=document.createElement("h1"),_h2.textContent=" Camera ",_h2),"\n      ",video,"\n      ",(_2=document.createElement("button"),_2.onclick=action.start,_2.setAttribute("class",""+String(css.button)),_2.textContent="\n        Start Camera\n      ",_2),"\n    "]),_camera),"\n    ",(_canvas3=document.createElement("div"),_canvas3.setAttribute("class","canvas"),_appendChild(_canvas3,["\n      ",(_h3=document.createElement("h1"),_h3.textContent=" Canvas ",_h3),"\n      ",canvas,"\n      ",processing,"\n      ",(_button=document.createElement("button"),_button.onclick=action.snap,_button.setAttribute("class",""+String(css.button)),_button.textContent="\n        Snap photo\n      ",_button),"\n    "]),_canvas3),"\n    ",(_div=document.createElement("div"),_appendChild(_div,["\n      ",(_h4=document.createElement("h1"),_h4.textContent=" Image ",_h4),"\n      ",photo,"\n      ",(_button2=document.createElement("button"),_button2.onclick=action.save,_button2.setAttribute("class",""+String(css.button)),_button2.textContent="\n        Save photo\n      ",_button2),"\n    "]),_div),"\n  "]),_3);document.body.appendChild(element);var filter={crazy:function(e,t){e.filter="grayscale(0%) blur(3px) brightness(170%) contrast(128%) hue-rotate(230deg) opacity(100%) invert(30%) saturate(500%) sepia(24%)"},crazyAlternative:function(e,t){t=t||e.getImageData(0,0,e.canvas.clientWidth,e.canvas.clientHeight);for(var n=0;n<t.width*t.height;n++){var a=4*n;t.data[a+0]=255-t.data[a+0],t.data[a+1]=255-t.data[a+1],t.data[a+2]=255-t.data[a+2]}return t},greyscale:function(e,t){t=t||e.getImageData(0,0,e.canvas.clientWidth,e.canvas.clientHeight);for(var n,a,i,o,c=0,r=t.length;c<r;c+=4)n=t[c],i=t[c+1],a=t[c+2],o=(n+i+a)/3,t[c]=t[c+1]=t[c+2]=o;return t}};!function(){if(navigator.mediaDevices||navigator.mediaDevices.enumerateDevices){for(;videoSelect.firstChild;)videoSelect.removeChild(videoSelect.firstChild);for(;audioInputSelect.firstChild;)audioInputSelect.removeChild(audioInputSelect.firstChild);for(;audioOutputSelect.firstChild;)audioOutputSelect.removeChild(audioOutputSelect.firstChild);navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){console.log(e.kind+": "+e.label+" (id = "+e.deviceId+")");var t=document.createElement("option");t.value=e.deviceId,"audioinput"===e.kind?(t.text=e.label||"Microphone "+(audioInputSelect.length+1),audioInputSelect.appendChild(t)):"audiooutput"===e.kind?(t.text=e.label||"Speaker "+(audioOutputSelect.length+1),audioOutputSelect.appendChild(t)):"videoinput"===e.kind&&(t.text=e.label||"Camera "+(videoSelect.length+1),videoSelect.appendChild(t))})}).catch(handleError)}}()},{"csjs-inject":3,"yo-yoify/lib/appendChild":21}]},{},[22]);
//# sourceMappingURL=bundle.js.map
